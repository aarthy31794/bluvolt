function SettingsController(e,t,n){function a(t,n,a,i){localStorage.setItem("v_units",e.units),localStorage.setItem("v_unitMinValue",t),localStorage.setItem("v_unitMaxValue",n),localStorage.setItem("v_voltageMinValue",a),localStorage.setItem("v_voltageMaxValue",i);var o=Number(n)-Number(t),l=Number(i)-Number(a),r=l/o;localStorage.setItem("v_scaleVal",r)}e.units="",e.unitMinValue="",e.unitMaxValue="",e.voltageMinValue="",e.voltageMaxValue="",localStorage.getItem("v_units")&&localStorage.getItem("v_unitMinValue")&&localStorage.getItem("v_unitMaxValue")?(e.units=localStorage.getItem("v_units"),e.unitMinValue=Number(localStorage.getItem("v_unitMinValue")),e.unitMaxValue=Number(localStorage.getItem("v_unitMaxValue"))):(e.units="V",e.unitMinValue=0,e.unitMaxValue=10),localStorage.getItem("v_voltageMinValue")&&localStorage.getItem("v_voltageMaxValue")?(e.voltageMinValue=Number(localStorage.getItem("v_voltageMinValue")),e.voltageMaxValue=Number(localStorage.getItem("v_voltageMaxValue"))):(e.voltageMinValue=0,e.voltageMaxValue=10),e.keyDown=function(t){e.err="",t.keyCode&&13===t.keyCode&&e.submitClick()},e.submitClick=function(){e.err="";var t=document.getElementById("unit_minVal"),n=document.getElementById("unit_maxVal"),i=document.getElementById("volt_minVal"),o=document.getElementById("volt_maxVal");return e.units?isNaN(e.units)?0!==t.value&&void 0==t.value||0!==t.value&&""==t.value?void(e.err="* Unit min value is required"):0!==n.value&&void 0==n.value||0!==n.value&&""==n.value?void(e.err="* Unit max value is required"):0!==i.value&&void 0==i.value||0!==i.value&&""==i.value?void(e.err="* Voltage min value is required"):0!==o.value&&void 0==o.value||0!==o.value&&""==o.value?void(e.err="* Voltage max value is required"):(a(t.value,n.value,i.value,o.value),void e.cancelClick()):void(e.err="* Unit name should not be number"):(e.err="* Unit name is required",!1)},e.resetClick=function(){e.units="V",e.unitMinValue=0,e.unitMaxValue=10,e.voltageMinValue=0,e.voltageMaxValue=10,a(e.unitMinValue,e.unitMaxValue,e.voltageMinValue,e.voltageMaxValue)},e.cancelClick=function(){n.cancel()}}function disableMouseClick(){document.addEventListener("contextmenu",function(e){e.preventDefault()})}SettingsController.$inject=["$scope","$mdToast","$mdDialog"];var app;!function(){app=angular.module("bluvolt",["ngMaterial","ngMdIcons","ngMessages"]).config(["$mdThemingProvider",function(e){e.theme("default").primaryPalette("blue").accentPalette("indigo"),e.theme("success-toast"),e.theme("error-toast"),e.alwaysWatchTheme(!0)}])}(),disableMouseClick();for(var match,pl=/\+/g,search=/([^&=]+)=?([^&]*)/g,decode=function(e){return decodeURIComponent(e.replace(pl," "))},query=window.location.search.substring(1),urlParams={};match=search.exec(query);)urlParams[decode(match[1])]=decode(match[2]);var cordovaApp=urlParams.app;!function(){"use strict";angular.module("bluvolt").service("bluVoltService",function(){return new BluVolt})}();var BluVolt=function(){function e(){n=this,this.connected=!1,this.bluetoothDevice=void 0,this.deviceNameCharacteristic=void 0,this.hardwareCharacteristic=void 0,this.softwareCharacteristic=void 0,this.hardwareVersion=void 0,this.softwareVersion=void 0,this.voltage=void 0,this.externalValueReceiver}function t(e){var t=new DataView(e.buffer);n.voltage=t.getFloat32(0,!1),n.externalValueReceiver&&n.externalValueReceiver("valueReceive")}var n,a="fd660001-29c4-11e7-8c79-794c8b1831f9",i="fd660002-29c4-11e7-8c79-794c8b1831f9",o=6154,l=10791,r=10792;return e.prototype.connect=function(){var e={filters:[{services:[a]}]};return navigator.bluetooth.requestDevice(e).then(function(e){return n.bluetoothDevice=e,n.bluetoothDevice.on("gattserverdisconnected",function(){n.clearAll(),n.externalValueReceiver&&n.externalValueReceiver("disconnect")}),e.gatt.connect()}).then(function(e){return Promise.all([e.getPrimaryService(o).then(function(e){e.getCharacteristic(l).then(function(e){n.hardwareCharacteristic=e,e.readValue().then(function(e){for(var t="",a=0;a<e.byteLength;a++)t+=String.fromCharCode(e.getUint8(a));t=t.trim(),n.hardwareVersion=t,void 0!==n.softwareVersion&&n.externalValueReceiver&&n.externalValueReceiver("updateFirmware")})}),e.getCharacteristic(r).then(function(e){n.softwareCharacteristic=e,e.readValue().then(function(e){for(var t="",a=0;a<e.byteLength;a++)t+=String.fromCharCode(e.getUint8(a));t=t.trim(),n.softwareVersion=t,void 0!==n.hardwareVersion&&n.externalValueReceiver&&n.externalValueReceiver("updateFirmware")})})},function(e){Promise.resolve(!0)}),e.getPrimaryService(a).then(function(e){e.getCharacteristic(i).then(function(e){return e.startNotifications().then(function(){e.addEventListener("characteristicvaluechanged",function(e){t(e.target.value)})})})},function(e){Promise.resolve(!0)})])}).then(function(){n.connected=!0})},e.prototype.disconnect=function(){return n.bluetoothDevice?n.bluetoothDevice.disconnect().then(function(){return n.clearAll(),Promise.resolve()}):Promise.reject()},e.prototype.setExternalValueReceiver=function(e){n.externalValueReceiver=e},e.prototype.clearAll=function(){n.connected=!1,n.bluetoothDevice=void 0,n.deviceNameCharacteristic=void 0,n.hardwareCharacteristic=void 0,n.softwareCharacteristic=void 0,n.hardwareVersion=void 0,n.softwareVersion=void 0,n.voltage=void 0},e}();void 0===window&&(module.exports.BluVolt=BluVolt),app.controller("mainController",["$scope","$mdToast","$mdDialog","bluVoltService",function(e,t,n,a){function i(e){t.show(t.simple().textContent(e).position("top").theme("success-toast").hideDelay(2500))}function o(e){t.show(t.simple().textContent(e).position("top").theme("error-toast").hideDelay(2500))}function l(t,a){function i(e,t,n){e.items=n,e.closeDialog=function(){t.hide()}}i.$inject=["$scope","$mdDialog","items"];var o=angular.element(document.body);n.show({parent:o,targetEvent:t,clickOutsideToClose:!1,template:'<md-dialog style="width: 250px;top:100px;margin-top: -170px;" aria-label="loadingDialog"><md-dialog-content><div layout="row" layout-align="center" style="padding: 40px;"><div style="padding-bottom: 20px;"><div><img src="app/images/loader.gif" width="80px" height="80px"></div></div></div><div layout="row" layout-align="center" style="padding-bottom: 20px; margin-top: -38px;"><label>'+a+"</label></div></md-dialog-content></md-dialog>",locals:{items:e.items},controller:i})}function r(){n.cancel()}function u(t){if("valueReceive"==t){if(e.bluvolt.voltage)if(null!==localStorage.getItem("v_scaleVal")&&null!==localStorage.getItem("v_units")&&null!==localStorage.getItem("v_voltageMinValue")&&null!==localStorage.getItem("v_unitMinValue")){var n=Number(localStorage.getItem("v_scaleVal")),a=Number(localStorage.getItem("v_voltageMinValue")),i=Number(localStorage.getItem("v_unitMinValue")),o=(e.bluvolt.voltage-a)/n;e.voltageValue=(o+i).toFixed(3),e.voltageUnits=localStorage.getItem("v_units")}else e.voltageValue=e.bluvolt.voltage.toFixed(3),e.voltageUnits="volt";e.$apply()}else"disconnect"==t?(e.voltageValue="",e.$apply()):"updateFirmware"==t&&c()}function c(){if(void 0!==dfuimpl){var t=e.bluvolt.bluetoothDevice.uuid,n={};n.uuid=t,n.swVersion=e.bluvolt.softwareVersion,n.hwVersion=e.bluvolt.hardwareVersion,dfuimpl.request("startDFU",JSON.stringify(n),function(e){},function(){})}}e.bluvolt=a,e.isApp=!1,"true"==cordovaApp&&(e.isApp=!0),setTimeout(function(){window.plugins.insomnia.keepAwake()},5e3),e.onConnect=function(){l("","Connecting ...."),e.bluvolt.connect().then(function(){r(),i("Connected..."),e.bluvolt.setExternalValueReceiver(u)})["catch"](function(e){r(),o(e)})},e.onDisconnect=function(){var t=n.confirm().title("BluVolt").textContent("Would you like to disconnect this device?").ariaLabel("Lucky day").ok("Yes").cancel("No");n.show(t).then(function(){e.bluvolt.disconnect().then(function(){e.voltageValue="",e.$apply()})},function(){})},e.showSettingsDialog=function(e){n.show({controller:SettingsController,templateUrl:"app/settings/settings.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!1}).then(function(e){},function(){})},e.isApp||(navigator.bluetooth?navigator.bluetooth.referringDevice&&e.onConnect():o("Bluetooth not supported, which is required."))}]),angular.module("bluvolt").run(["$templateCache",function(e){e.put("app/settings/settings.html",'<md-dialog aria-label="Settings"><form name="settingsForm"><md-toolbar><div class="md-toolbar-tools"><h2>Settings</h2><span flex></span><md-button class="md-primary md-icon-button" ng-click="cancelClick()" aria-label="Close" style="color:white"><ng-md-icon icon="clear"></ng-md-icon></md-button></div></md-toolbar><md-dialog-content><div class="md-dialog-content"><table cellspacing="0" class="table_range" width="85%" align="center" border="0"><tr><td width="28">&nbsp;</td><td width="140">Display Unit :</td><td align="right" width="152"><md-input-container><input aria-label="unitsInputBox" ng-keydown="keyDown($event)" ng-model="units"></md-input-container></td></tr><tr><td align="center" colspan="3"></td></tr><td>&nbsp;</td><td colspan="2" rowspan="3"><table cellspacing="0" class="range_border" width="100%"><tr><td align="center" bgcolor="#CCCCCC" height="30">Voltage Range</td><td align="center" bgcolor="#CCCCCC" height="30">Display Range</td></tr><tr><td align="center" class="text_space" valign="middle"><md-input-container><input aria-label="voltMinInputBox" ng-keydown="keyDown($event)" ng-model="voltageMinValue" id="volt_minVal" ng-pattern="/^[+-]?[0-9]{1,9}(?:\\.[0-9]{1,2})?$/" type="number"></md-input-container></td><td align="center" class="text_space" valign="middle"><md-input-container><input aria-label="unitMinInputBox" ng-keydown="keyDown($event)" ng-model="unitMinValue" id="unit_minVal" ng-pattern="/^[+-]?[0-9]{1,9}(?:\\.[0-9]{1,2})?$/" type="number"></md-input-container></td></tr><tr><td align="center" class="text_space" valign="middle"><md-input-container><input aria-label="voltMaxInputBox" ng-keydown="keyDown($event)" ng-model="voltageMaxValue" id="volt_maxVal" ng-pattern="/^[+-]?[0-9]{1,9}(?:\\.[0-9]{1,2})?$/" type="number"></md-input-container></td><td align="center" class="text_space" valign="middle"><md-input-container><input aria-label="unitMaxInputBox" ng-keydown="keyDown($event)" ng-model="unitMaxValue" id="unit_maxVal" ng-pattern="/^[+-]?[0-9]{1,9}(?:\\.[0-9]{1,2})?$/" type="number"></md-input-container></td></tr></table></td><tr><td>Min</td></tr><tr><td height="40">Max</td></tr><tr><td>&nbsp;</td><td colspan="2"><span class="settings-input-error">{{err}}</span></td></tr></table><div layout="row" layout-align="space-around center"><md-button class="md-primary md-raised text_style" ng-click="resetClick()">Reset</md-button><md-button class="md-primary md-raised text_style" ng-click="submitClick()">Save</md-button></div></div></md-dialog-content></form></md-dialog>')}]);